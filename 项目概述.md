# 项目概述

## 项目定位
- 面向多部书籍语料的知识图谱抽取 MVP，先以《西游记》为示例跑通整体链路。
- 目标：从原文到结构化 JSON 的实体/关系/事件抽取，支持审阅与对比评估，后续可扩展入库与服务化。

## 核心功能
- 章节切分：将原文切分为稳定的章节文件，支持编号或“编号+标题”两种命名模式。
- 批量抽取：按章节调用 LLM 接口，生成规范化 JSON；支持多 Prompt 模板与动态选择。
- 配置管理：统一使用 YAML 作为唯一配置源，集中管理路径、模型、命名与阈值。
- 日志与审计：输出结构化日志，记录 `stage/template_id/model_name/chapter_id/chapter_title/duration_ms/records_count`。
- 对比评估接口：提供章节级汇总与对比的服务能力，支持不同模板/模型的覆盖率与差异统计。

## 架构流程
- 文本来源 → 章节切分 → 批量抽取(JSON) → 人工审阅 → 对比评估接口 → 入库/查询（规划）。
- 命名按 `<book>` 维度管理，保证原文、章节与结果的一致映射。

## 技术栈
- 后端框架：`fastapi`（服务与接口）
- LLM SDK：`openai` 兼容接口（当前基于 Qwen Plus）
- 配置与模型：`pyyaml`、`pydantic`（读取与校验）
- 运行与未来：`uvicorn`（服务运行，规划）、`APScheduler`（调度，规划）、`Neo4j`（图数据库，规划）

## 关键依赖
- `openai`、`fastapi`、`pydantic`、`python-dotenv`、`pyyaml`、`tomllib`（Python 3.11+）
- 版本与锁定：后续统一到依赖清单并锁定版本，保障复现与线上稳定性。

## 配置与命名
- 配置文件：`settings.yaml`，作为唯一配置源；敏感信息置于环境变量。
- 命名策略：
  - 编号模式：`chapter_001.txt → result_001.json`
  - 标题前缀模式：`001_第一回 … .txt` 用于审阅；与编号一一映射
- 多模板结果命名：默认模板写入 `result_XXX.json`；非默认模板写入 `result_XXX__tpl-<template_id>.json`；可选模型维度 `__model-<model_name>`。

## 多语料规范
- 统一使用 `book_key`（英文/拼音键，如 `xiyouji`）作为目录命名；`book_name`（中文展示名，如 `西游记`）用于日志/元信息展示。
- 路径建议：`data/raw/<book_key>/xiyouji.txt`、`data/chapters/<book_key>/chapter_001.txt`、`data/results/<book_key>/result_001.json`。
- 结果 `meta` 建议同时包含 `book_key` 与 `book_name`，便于跨语料汇总与展示。

## 结果计量口径
- 默认以关系与事件分别计数，并提供总计；接口返回 `relations_count_by_template` 与 `events_count_by_template`，日志建议补充合计值。

## 依赖版本建议（说明性）
- `fastapi >= 0.116`
- `pydantic >= 2.11.7`
- `openai >= 2.8.1`
- `pyyaml >= 6.0.3`
- `python-dotenv >= 1.2.1`
- `python >= 3.13.0`
- 说明：版本建议用于团队对齐与兼容性参考，后续统一到依赖清单并锁定。

## 日志约定
- 记录范围：`split/extract/compare`（当前）、`validate/import`（规划）
- 核心字段：`timestamp/book/stage/chapter_id/chapter_title/model_name/template_id/duration_ms/records_count/status/error_type/error_message`
- 等级：以 `INFO` 为主，失败 `ERROR`，非致命异常 `WARNING`

## 路线图
- 短期：统一配置与命名、完善结构化日志、跑通对比评估接口
- 中期：结果校验与统计、Neo4j 模型与入库脚本雏形
- 长期：调度编排与并发优化、服务化查询与最小可视化

## 风险与约束
- LLM 成本与稳定性需要控制（重试与缓存策略）
- 不同语料的章节标识差异需要可配置与回退方案
- 环境变量与密钥管理需严格隔离，不进入版本控制
